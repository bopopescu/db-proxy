drop table if exists slave_tag_test;
create table slave_tag_test(tc1 int primary key, tc2 int);
remove user backends slave_tag1;
status
remove slave tag tag_mt;
status
remove slave tag tag_dp;
status
select * from pwds;
username	password	hosts	backends	type
slave_tag1	8XjhBQKd			proxy
slave_tag2	8XjhBQKd			proxy
slave_tag3	8XjhBQKd			proxy
%				proxy
dbproxy_test	8XjhBQKd			admin
dbproxy_test	8XjhBQKd			proxy
select * from backends;
backend_ndx	address	hostname	state	type	weight	tag	threads_running
1	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	rw	0	NULL	0
2	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	ro	1	NULL	0
3	10.32.45.149:5002	dbproxy-functest02.dx.meituandianping.com	up	ro	1	NULL	0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
remove user backends slave_tag1;
status
remove slave tag tag_mt;
status
remove slave tag tag_dp;
status
add slave tag tag_mt 2;
status
select * from pwds;
username	password	hosts	backends	type
slave_tag1	8XjhBQKd			proxy
slave_tag2	8XjhBQKd			proxy
slave_tag3	8XjhBQKd			proxy
%				proxy
dbproxy_test	8XjhBQKd			admin
dbproxy_test	8XjhBQKd			proxy
select * from backends;
backend_ndx	address	hostname	state	type	weight	tag	threads_running
1	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	rw	0	NULL	0
2	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	ro	1	tag_mt	0
3	10.32.45.149:5002	dbproxy-functest02.dx.meituandianping.com	up	ro	1	NULL	0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_dp*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_dp*/select count(*) from test.slave_tag_test;
count(*)
0
remove user backends slave_tag1;
status
remove slave tag tag_mt;
status
remove slave tag tag_dp;
status
add slave tag tag_mt 2;
status
add slave tag tag_dp 3;
status
select * from pwds;
username	password	hosts	backends	type
slave_tag1	8XjhBQKd			proxy
slave_tag2	8XjhBQKd			proxy
slave_tag3	8XjhBQKd			proxy
%				proxy
dbproxy_test	8XjhBQKd			admin
dbproxy_test	8XjhBQKd			proxy
select * from backends;
backend_ndx	address	hostname	state	type	weight	tag	threads_running
1	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	rw	0	NULL	0
2	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	ro	1	tag_mt	0
3	10.32.45.149:5002	dbproxy-functest02.dx.meituandianping.com	up	ro	1	tag_dp	0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_dp*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_dp*/select count(*) from test.slave_tag_test;
count(*)
0
remove user backends slave_tag1;
status
remove slave tag tag_mt;
status
remove slave tag tag_dp;
status
add slave tag tag_mt 2;
status
add slave tag tag_mt 3;
status
select * from pwds;
username	password	hosts	backends	type
slave_tag1	8XjhBQKd			proxy
slave_tag2	8XjhBQKd			proxy
slave_tag3	8XjhBQKd			proxy
%				proxy
dbproxy_test	8XjhBQKd			admin
dbproxy_test	8XjhBQKd			proxy
select * from backends;
backend_ndx	address	hostname	state	type	weight	tag	threads_running
1	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	rw	0	NULL	0
2	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	ro	1	tag_mt	0
3	10.32.45.149:5002	dbproxy-functest02.dx.meituandianping.com	up	ro	1	tag_mt	0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_dp*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_dp*/select count(*) from test.slave_tag_test;
count(*)
0
remove user backends slave_tag1;
status
remove slave tag tag_mt;
status
remove slave tag tag_dp;
status
add user backends slave_tag1@tag_mt;
status
select * from pwds;
username	password	hosts	backends	type
slave_tag1	8XjhBQKd		tag_mt	proxy
slave_tag2	8XjhBQKd			proxy
slave_tag3	8XjhBQKd			proxy
%				proxy
dbproxy_test	8XjhBQKd			admin
dbproxy_test	8XjhBQKd			proxy
select * from backends;
backend_ndx	address	hostname	state	type	weight	tag	threads_running
1	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	rw	0	NULL	0
2	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	ro	1	NULL	0
3	10.32.45.149:5002	dbproxy-functest02.dx.meituandianping.com	up	ro	1	NULL	0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_dp*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_dp*/select count(*) from test.slave_tag_test;
count(*)
0
remove user backends slave_tag1;
status
remove slave tag tag_mt;
status
remove slave tag tag_dp;
status
add user backends slave_tag1@tag_mt;
status
add slave tag tag_mt 2;
status
select * from pwds;
username	password	hosts	backends	type
slave_tag1	8XjhBQKd		tag_mt	proxy
slave_tag2	8XjhBQKd			proxy
slave_tag3	8XjhBQKd			proxy
%				proxy
dbproxy_test	8XjhBQKd			admin
dbproxy_test	8XjhBQKd			proxy
select * from backends;
backend_ndx	address	hostname	state	type	weight	tag	threads_running
1	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	rw	0	NULL	0
2	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	ro	1	tag_mt	0
3	10.32.45.149:5002	dbproxy-functest02.dx.meituandianping.com	up	ro	1	NULL	0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
remove user backends slave_tag1;
status
remove slave tag tag_mt;
status
remove slave tag tag_dp;
status
add user backends slave_tag1@tag_mt;
status
add slave tag tag_mt 2,3;
status
select * from pwds;
username	password	hosts	backends	type
slave_tag1	8XjhBQKd		tag_mt	proxy
slave_tag2	8XjhBQKd			proxy
slave_tag3	8XjhBQKd			proxy
%				proxy
dbproxy_test	8XjhBQKd			admin
dbproxy_test	8XjhBQKd			proxy
select * from backends;
backend_ndx	address	hostname	state	type	weight	tag	threads_running
1	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	rw	0	NULL	0
2	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	ro	1	tag_mt	0
3	10.32.45.149:5002	dbproxy-functest02.dx.meituandianping.com	up	ro	1	tag_mt	0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
remove user backends slave_tag1;
status
remove slave tag tag_mt;
status
remove slave tag tag_dp;
status
add user backends slave_tag1@tag_mt|tag_dp;
status
select * from pwds;
username	password	hosts	backends	type
slave_tag1	8XjhBQKd		tag_dp|tag_mt	proxy
slave_tag2	8XjhBQKd			proxy
slave_tag3	8XjhBQKd			proxy
%				proxy
dbproxy_test	8XjhBQKd			admin
dbproxy_test	8XjhBQKd			proxy
select * from backends;
backend_ndx	address	hostname	state	type	weight	tag	threads_running
1	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	rw	0	NULL	0
2	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	ro	1	NULL	0
3	10.32.45.149:5002	dbproxy-functest02.dx.meituandianping.com	up	ro	1	NULL	0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
remove user backends slave_tag1;
status
remove slave tag tag_mt;
status
remove slave tag tag_dp;
status
add user backends slave_tag1@tag_mt|tag_dp;
status
add slave tag tag_mt 2;
status
select * from pwds;
username	password	hosts	backends	type
slave_tag1	8XjhBQKd		tag_dp|tag_mt	proxy
slave_tag2	8XjhBQKd			proxy
slave_tag3	8XjhBQKd			proxy
%				proxy
dbproxy_test	8XjhBQKd			admin
dbproxy_test	8XjhBQKd			proxy
select * from backends;
backend_ndx	address	hostname	state	type	weight	tag	threads_running
1	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	rw	0	NULL	0
2	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	ro	1	tag_mt	0
3	10.32.45.149:5002	dbproxy-functest02.dx.meituandianping.com	up	ro	1	NULL	0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_dp*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_dp*/select count(*) from test.slave_tag_test;
count(*)
0
remove user backends slave_tag1;
status
remove slave tag tag_mt;
status
remove slave tag tag_dp;
status
add user backends slave_tag1@tag_mt|tag_dp;
status
add slave tag tag_mt 2;
status
add slave tag tag_dp 3;
status
select * from pwds;
username	password	hosts	backends	type
slave_tag1	8XjhBQKd		tag_dp|tag_mt	proxy
slave_tag2	8XjhBQKd			proxy
slave_tag3	8XjhBQKd			proxy
%				proxy
dbproxy_test	8XjhBQKd			admin
dbproxy_test	8XjhBQKd			proxy
select * from backends;
backend_ndx	address	hostname	state	type	weight	tag	threads_running
1	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	rw	0	NULL	0
2	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	ro	1	tag_mt	0
3	10.32.45.149:5002	dbproxy-functest02.dx.meituandianping.com	up	ro	1	tag_dp	0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_dp*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_dp*/select count(*) from test.slave_tag_test;
count(*)
0
remove user backends slave_tag1;
status
remove slave tag tag_mt;
status
remove slave tag tag_dp;
status
alter slave weight 2 4;
status
alter slave weight 3 1;
status
select * from pwds;
username	password	hosts	backends	type
slave_tag1	8XjhBQKd			proxy
slave_tag2	8XjhBQKd			proxy
slave_tag3	8XjhBQKd			proxy
%				proxy
dbproxy_test	8XjhBQKd			admin
dbproxy_test	8XjhBQKd			proxy
select * from backends;
backend_ndx	address	hostname	state	type	weight	tag	threads_running
1	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	rw	0	NULL	0
2	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	ro	4	NULL	0
3	10.32.45.149:5002	dbproxy-functest02.dx.meituandianping.com	up	ro	1	NULL	0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
remove user backends slave_tag1;
status
remove slave tag tag_mt;
status
remove slave tag tag_dp;
status
add user backends slave_tag1@tag_mt;
status
add slave tag tag_mt 2,3;
status
alter slave weight 2 4;
status
alter slave weight 3 1;
status
select * from pwds;
username	password	hosts	backends	type
slave_tag1	8XjhBQKd		tag_mt	proxy
slave_tag2	8XjhBQKd			proxy
slave_tag3	8XjhBQKd			proxy
%				proxy
dbproxy_test	8XjhBQKd			admin
dbproxy_test	8XjhBQKd			proxy
select * from backends;
backend_ndx	address	hostname	state	type	weight	tag	threads_running
1	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	rw	0	NULL	0
2	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	ro	4	tag_mt	0
3	10.32.45.149:5002	dbproxy-functest02.dx.meituandianping.com	up	ro	1	tag_mt	0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
remove user backends slave_tag1;
status
remove slave tag tag_mt;
status
remove slave tag tag_dp;
status
add user backends slave_tag1@tag_mt|tag_dp;
status
add slave tag tag_mt 2,3;
status
alter slave weight 2 4;
status
alter slave weight 3 1;
status
select * from pwds;
username	password	hosts	backends	type
slave_tag1	8XjhBQKd		tag_dp|tag_mt	proxy
slave_tag2	8XjhBQKd			proxy
slave_tag3	8XjhBQKd			proxy
%				proxy
dbproxy_test	8XjhBQKd			admin
dbproxy_test	8XjhBQKd			proxy
select * from backends;
backend_ndx	address	hostname	state	type	weight	tag	threads_running
1	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	rw	0	NULL	0
2	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	ro	4	tag_mt	0
3	10.32.45.149:5002	dbproxy-functest02.dx.meituandianping.com	up	ro	1	tag_mt	0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
remove user backends slave_tag1;
status
remove slave tag tag_mt;
status
remove slave tag tag_dp;
status
select * from pwds;
username	password	hosts	backends	type
slave_tag1	8XjhBQKd			proxy
slave_tag2	8XjhBQKd			proxy
slave_tag3	8XjhBQKd			proxy
%				proxy
dbproxy_test	8XjhBQKd			admin
dbproxy_test	8XjhBQKd			proxy
select * from backends;
backend_ndx	address	hostname	state	type	weight	tag	threads_running
1	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	rw	0	NULL	0
2	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	ro	4	NULL	0
3	10.32.45.149:5002	dbproxy-functest02.dx.meituandianping.com	up	ro	1	NULL	0
alter slave weight 2 0;
status
select * from backends;
backend_ndx	address	hostname	state	type	weight	tag	threads_running
1	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	rw	0	NULL	0
2	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	ro	4	NULL	0
3	10.32.45.149:5002	dbproxy-functest02.dx.meituandianping.com	up	ro	1	NULL	0
remove user backends slave_tag1;
status
remove slave tag tag_mt;
status
remove slave tag tag_dp;
status
select * from pwds;
username	password	hosts	backends	type
slave_tag1	8XjhBQKd			proxy
slave_tag2	8XjhBQKd			proxy
slave_tag3	8XjhBQKd			proxy
%				proxy
dbproxy_test	8XjhBQKd			admin
dbproxy_test	8XjhBQKd			proxy
select * from backends;
backend_ndx	address	hostname	state	type	weight	tag	threads_running
1	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	rw	0	NULL	0
2	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	ro	4	NULL	0
3	10.32.45.149:5002	dbproxy-functest02.dx.meituandianping.com	up	ro	1	NULL	0
alter slave weight 2048 2;
status
select * from backends;
backend_ndx	address	hostname	state	type	weight	tag	threads_running
1	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	rw	0	NULL	0
2	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	ro	4	NULL	0
3	10.32.45.149:5002	dbproxy-functest02.dx.meituandianping.com	up	ro	1	NULL	0
remove user backends slave_tag1;
status
remove slave tag tag_mt;
status
remove slave tag tag_dp;
status
select * from pwds;
username	password	hosts	backends	type
slave_tag1	8XjhBQKd			proxy
slave_tag2	8XjhBQKd			proxy
slave_tag3	8XjhBQKd			proxy
%				proxy
dbproxy_test	8XjhBQKd			admin
dbproxy_test	8XjhBQKd			proxy
select * from backends;
backend_ndx	address	hostname	state	type	weight	tag	threads_running
1	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	rw	0	NULL	0
2	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	ro	4	NULL	0
3	10.32.45.149:5002	dbproxy-functest02.dx.meituandianping.com	up	ro	1	NULL	0
alter slave weight 1 2;
status
select * from backends;
backend_ndx	address	hostname	state	type	weight	tag	threads_running
1	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	rw	0	NULL	0
2	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	ro	4	NULL	0
3	10.32.45.149:5002	dbproxy-functest02.dx.meituandianping.com	up	ro	1	NULL	0
remove user backends slave_tag1;
status
remove slave tag tag_mt;
status
remove slave tag tag_dp;
status
select * from pwds;
username	password	hosts	backends	type
slave_tag1	8XjhBQKd			proxy
slave_tag2	8XjhBQKd			proxy
slave_tag3	8XjhBQKd			proxy
%				proxy
dbproxy_test	8XjhBQKd			admin
dbproxy_test	8XjhBQKd			proxy
select * from backends;
backend_ndx	address	hostname	state	type	weight	tag	threads_running
1	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	rw	0	NULL	0
2	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	ro	4	NULL	0
3	10.32.45.149:5002	dbproxy-functest02.dx.meituandianping.com	up	ro	1	NULL	0
alter slave weight 2 4;
status
select * from backends;
backend_ndx	address	hostname	state	type	weight	tag	threads_running
1	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	rw	0	NULL	0
2	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	ro	4	NULL	0
3	10.32.45.149:5002	dbproxy-functest02.dx.meituandianping.com	up	ro	1	NULL	0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
remove user backends slave_tag1;
status
remove slave tag tag_mt;
status
remove slave tag tag_dp;
status
add slave tag tag_mt 2;
status
add slave tag tag_mt 3;
status
add user backends slave_tag1@tag_mt;
status
select * from pwds;
username	password	hosts	backends	type
slave_tag1	8XjhBQKd		tag_mt	proxy
slave_tag2	8XjhBQKd			proxy
slave_tag3	8XjhBQKd			proxy
%				proxy
dbproxy_test	8XjhBQKd			admin
dbproxy_test	8XjhBQKd			proxy
select * from backends;
backend_ndx	address	hostname	state	type	weight	tag	threads_running
1	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	rw	0	NULL	0
2	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	ro	4	tag_mt	0
3	10.32.45.149:5002	dbproxy-functest02.dx.meituandianping.com	up	ro	1	tag_mt	0
alter slave weight 2 4;
status
select * from backends;
backend_ndx	address	hostname	state	type	weight	tag	threads_running
1	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	rw	0	NULL	0
2	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	ro	4	tag_mt	0
3	10.32.45.149:5002	dbproxy-functest02.dx.meituandianping.com	up	ro	1	tag_mt	0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
remove user backends slave_tag1;
status
remove slave tag tag_mt;
status
remove slave tag tag_dp;
status
select * from pwds;
username	password	hosts	backends	type
slave_tag1	8XjhBQKd			proxy
slave_tag2	8XjhBQKd			proxy
slave_tag3	8XjhBQKd			proxy
%				proxy
dbproxy_test	8XjhBQKd			admin
dbproxy_test	8XjhBQKd			proxy
select * from backends;
backend_ndx	address	hostname	state	type	weight	tag	threads_running
1	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	rw	0	NULL	0
2	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	ro	4	NULL	0
3	10.32.45.149:5002	dbproxy-functest02.dx.meituandianping.com	up	ro	1	NULL	0
add slave tag tag_mt -1024;
status
select * from backends;
backend_ndx	address	hostname	state	type	weight	tag	threads_running
1	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	rw	0	NULL	0
2	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	ro	4	NULL	0
3	10.32.45.149:5002	dbproxy-functest02.dx.meituandianping.com	up	ro	1	NULL	0
remove user backends slave_tag1;
status
remove slave tag tag_mt;
status
remove slave tag tag_dp;
status
select * from pwds;
username	password	hosts	backends	type
slave_tag1	8XjhBQKd			proxy
slave_tag2	8XjhBQKd			proxy
slave_tag3	8XjhBQKd			proxy
%				proxy
dbproxy_test	8XjhBQKd			admin
dbproxy_test	8XjhBQKd			proxy
select * from backends;
backend_ndx	address	hostname	state	type	weight	tag	threads_running
1	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	rw	0	NULL	0
2	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	ro	4	NULL	0
3	10.32.45.149:5002	dbproxy-functest02.dx.meituandianping.com	up	ro	1	NULL	0
add slave tag tag_mt 2;
status
select * from backends;
backend_ndx	address	hostname	state	type	weight	tag	threads_running
1	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	rw	0	NULL	0
2	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	ro	4	tag_mt	0
3	10.32.45.149:5002	dbproxy-functest02.dx.meituandianping.com	up	ro	1	NULL	0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
remove user backends slave_tag1;
status
remove slave tag tag_mt;
status
remove slave tag tag_dp;
status
add slave tag tag_dp 2;
status
select * from pwds;
username	password	hosts	backends	type
slave_tag1	8XjhBQKd			proxy
slave_tag2	8XjhBQKd			proxy
slave_tag3	8XjhBQKd			proxy
%				proxy
dbproxy_test	8XjhBQKd			admin
dbproxy_test	8XjhBQKd			proxy
select * from backends;
backend_ndx	address	hostname	state	type	weight	tag	threads_running
1	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	rw	0	NULL	0
2	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	ro	4	tag_dp	0
3	10.32.45.149:5002	dbproxy-functest02.dx.meituandianping.com	up	ro	1	NULL	0
add slave tag tag_mt 2;
status
select * from backends;
backend_ndx	address	hostname	state	type	weight	tag	threads_running
1	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	rw	0	NULL	0
2	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	ro	4	tag_mt	0
3	10.32.45.149:5002	dbproxy-functest02.dx.meituandianping.com	up	ro	1	NULL	0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_dp*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_dp*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_dp*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_dp*/select count(*) from test.slave_tag_test;
count(*)
0
remove user backends slave_tag1;
status
remove slave tag tag_mt;
status
remove slave tag tag_dp;
status
select * from pwds;
username	password	hosts	backends	type
slave_tag1	8XjhBQKd			proxy
slave_tag2	8XjhBQKd			proxy
slave_tag3	8XjhBQKd			proxy
%				proxy
dbproxy_test	8XjhBQKd			admin
dbproxy_test	8XjhBQKd			proxy
select * from backends;
backend_ndx	address	hostname	state	type	weight	tag	threads_running
1	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	rw	0	NULL	0
2	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	ro	4	NULL	0
3	10.32.45.149:5002	dbproxy-functest02.dx.meituandianping.com	up	ro	1	NULL	0
add slave tag tag_mt 1;
status
select * from backends;
backend_ndx	address	hostname	state	type	weight	tag	threads_running
1	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	rw	0	NULL	0
2	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	ro	4	NULL	0
3	10.32.45.149:5002	dbproxy-functest02.dx.meituandianping.com	up	ro	1	NULL	0
remove user backends slave_tag1;
status
remove slave tag tag_mt;
status
remove slave tag tag_dp;
status
add user backends slave_tag1@tag_mt;
status
select * from pwds;
username	password	hosts	backends	type
slave_tag1	8XjhBQKd		tag_mt	proxy
slave_tag2	8XjhBQKd			proxy
slave_tag3	8XjhBQKd			proxy
%				proxy
dbproxy_test	8XjhBQKd			admin
dbproxy_test	8XjhBQKd			proxy
select * from backends;
backend_ndx	address	hostname	state	type	weight	tag	threads_running
1	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	rw	0	NULL	0
2	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	ro	4	NULL	0
3	10.32.45.149:5002	dbproxy-functest02.dx.meituandianping.com	up	ro	1	NULL	0
add slave tag tag_mt 2,3;
status
select * from backends;
backend_ndx	address	hostname	state	type	weight	tag	threads_running
1	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	rw	0	NULL	0
2	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	ro	4	tag_mt	0
3	10.32.45.149:5002	dbproxy-functest02.dx.meituandianping.com	up	ro	1	tag_mt	0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
remove user backends slave_tag1;
status
remove user backends slave_tag2;
status
remove slave tag tag_mt;
status
remove slave tag tag_dp;
status
add slave tag tag_dp 2,3;
status
add user backends slave_tag1@tag_mt;
status
add user backends slave_tag2@tag_dp;
status
select * from pwds;
username	password	hosts	backends	type
slave_tag1	8XjhBQKd		tag_mt	proxy
slave_tag2	8XjhBQKd		tag_dp	proxy
slave_tag3	8XjhBQKd			proxy
%				proxy
dbproxy_test	8XjhBQKd			admin
dbproxy_test	8XjhBQKd			proxy
select * from backends;
backend_ndx	address	hostname	state	type	weight	tag	threads_running
1	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	rw	0	NULL	0
2	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	ro	4	tag_dp	0
3	10.32.45.149:5002	dbproxy-functest02.dx.meituandianping.com	up	ro	1	tag_dp	0
add slave tag tag_mt 2;
status
select * from backends;
backend_ndx	address	hostname	state	type	weight	tag	threads_running
1	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	rw	0	NULL	0
2	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	ro	4	tag_mt	0
3	10.32.45.149:5002	dbproxy-functest02.dx.meituandianping.com	up	ro	1	tag_dp	0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_dp*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_dp*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_dp*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_dp*/select count(*) from test.slave_tag_test;
count(*)
0
remove user backends slave_tag1;
status
remove user backends slave_tag2;
status
remove slave tag tag_mt;
status
remove slave tag tag_dp;
status
add slave tag tag_mt 2;
status
add user backends slave_tag1@tag_mt;
status
add user backends slave_tag2@tag_dp;
status
select * from pwds;
username	password	hosts	backends	type
slave_tag1	8XjhBQKd		tag_mt	proxy
slave_tag2	8XjhBQKd		tag_dp	proxy
slave_tag3	8XjhBQKd			proxy
%				proxy
dbproxy_test	8XjhBQKd			admin
dbproxy_test	8XjhBQKd			proxy
select * from backends;
backend_ndx	address	hostname	state	type	weight	tag	threads_running
1	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	rw	0	NULL	0
2	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	ro	4	tag_mt	0
3	10.32.45.149:5002	dbproxy-functest02.dx.meituandianping.com	up	ro	1	NULL	0
add slave tag tag_dp 2;
status
select * from backends;
backend_ndx	address	hostname	state	type	weight	tag	threads_running
1	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	rw	0	NULL	0
2	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	ro	4	tag_dp	0
3	10.32.45.149:5002	dbproxy-functest02.dx.meituandianping.com	up	ro	1	NULL	0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_dp*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_dp*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_dp*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_dp*/select count(*) from test.slave_tag_test;
count(*)
0
remove user backends slave_tag1;
status
remove user backends slave_tag2;
status
select * from pwds;
username	password	hosts	backends	type
slave_tag1	8XjhBQKd			proxy
slave_tag2	8XjhBQKd			proxy
slave_tag3	8XjhBQKd			proxy
%				proxy
dbproxy_test	8XjhBQKd			admin
dbproxy_test	8XjhBQKd			proxy
select * from backends;
backend_ndx	address	hostname	state	type	weight	tag	threads_running
1	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	rw	0	NULL	0
2	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	ro	4	tag_dp	0
3	10.32.45.149:5002	dbproxy-functest02.dx.meituandianping.com	up	ro	1	NULL	0
remove slave tag tag_mt;
status
select * from backends;
backend_ndx	address	hostname	state	type	weight	tag	threads_running
1	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	rw	0	NULL	0
2	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	ro	4	tag_dp	0
3	10.32.45.149:5002	dbproxy-functest02.dx.meituandianping.com	up	ro	1	NULL	0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
remove user backends slave_tag1;
status
remove user backends slave_tag2;
status
add user backends slave_tag1@tag_mt;
status
add slave tag tag_mt 2;
status
select * from pwds;
username	password	hosts	backends	type
slave_tag1	8XjhBQKd		tag_mt	proxy
slave_tag2	8XjhBQKd			proxy
slave_tag3	8XjhBQKd			proxy
%				proxy
dbproxy_test	8XjhBQKd			admin
dbproxy_test	8XjhBQKd			proxy
select * from backends;
backend_ndx	address	hostname	state	type	weight	tag	threads_running
1	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	rw	0	NULL	0
2	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	ro	4	tag_mt	0
3	10.32.45.149:5002	dbproxy-functest02.dx.meituandianping.com	up	ro	1	NULL	0
remove slave tag tag_mt;
status
select * from backends;
backend_ndx	address	hostname	state	type	weight	tag	threads_running
1	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	rw	0	NULL	0
2	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	ro	4	NULL	0
3	10.32.45.149:5002	dbproxy-functest02.dx.meituandianping.com	up	ro	1	NULL	0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
remove user backends slave_tag1;
status
remove user backends slave_tag2;
status
select * from pwds;
username	password	hosts	backends	type
slave_tag1	8XjhBQKd			proxy
slave_tag2	8XjhBQKd			proxy
slave_tag3	8XjhBQKd			proxy
%				proxy
dbproxy_test	8XjhBQKd			admin
dbproxy_test	8XjhBQKd			proxy
select * from backends;
backend_ndx	address	hostname	state	type	weight	tag	threads_running
1	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	rw	0	NULL	0
2	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	ro	4	NULL	0
3	10.32.45.149:5002	dbproxy-functest02.dx.meituandianping.com	up	ro	1	NULL	0
remove slave tag tag_mt 2,3;
status
select * from backends;
backend_ndx	address	hostname	state	type	weight	tag	threads_running
1	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	rw	0	NULL	0
2	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	ro	4	NULL	0
3	10.32.45.149:5002	dbproxy-functest02.dx.meituandianping.com	up	ro	1	NULL	0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
remove user backends slave_tag1;
status
remove user backends slave_tag2;
status
add slave tag tag_mt 2,3;
status
add user backends slave_tag1@tag_mt;
status
select * from pwds;
username	password	hosts	backends	type
slave_tag1	8XjhBQKd		tag_mt	proxy
slave_tag2	8XjhBQKd			proxy
slave_tag3	8XjhBQKd			proxy
%				proxy
dbproxy_test	8XjhBQKd			admin
dbproxy_test	8XjhBQKd			proxy
select * from backends;
backend_ndx	address	hostname	state	type	weight	tag	threads_running
1	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	rw	0	NULL	0
2	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	ro	4	tag_mt	0
3	10.32.45.149:5002	dbproxy-functest02.dx.meituandianping.com	up	ro	1	tag_mt	0
remove slave tag tag_mt 2,3;
status
select * from backends;
backend_ndx	address	hostname	state	type	weight	tag	threads_running
1	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	rw	0	NULL	0
2	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	ro	4	NULL	0
3	10.32.45.149:5002	dbproxy-functest02.dx.meituandianping.com	up	ro	1	NULL	0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
remove user backends slave_tag1;
status
remove user backends slave_tag2;
status
add slave tag tag_mt 2,3;
status
add user backends slave_tag1@tag_mt;
status
select * from pwds;
username	password	hosts	backends	type
slave_tag1	8XjhBQKd		tag_mt	proxy
slave_tag2	8XjhBQKd			proxy
slave_tag3	8XjhBQKd			proxy
%				proxy
dbproxy_test	8XjhBQKd			admin
dbproxy_test	8XjhBQKd			proxy
select * from backends;
backend_ndx	address	hostname	state	type	weight	tag	threads_running
1	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	rw	0	NULL	0
2	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	ro	4	tag_mt	0
3	10.32.45.149:5002	dbproxy-functest02.dx.meituandianping.com	up	ro	1	tag_mt	0
remove slave tag tag_mt 2;
status
select * from backends;
backend_ndx	address	hostname	state	type	weight	tag	threads_running
1	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	rw	0	NULL	0
2	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	ro	4	NULL	0
3	10.32.45.149:5002	dbproxy-functest02.dx.meituandianping.com	up	ro	1	tag_mt	0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
remove user backends slave_tag1;
status
remove user backends slave_tag2;
status
add slave tag tag_mt 2,3;
status
add user backends slave_tag1@tag_mt;
status
select * from pwds;
username	password	hosts	backends	type
slave_tag1	8XjhBQKd		tag_mt	proxy
slave_tag2	8XjhBQKd			proxy
slave_tag3	8XjhBQKd			proxy
%				proxy
dbproxy_test	8XjhBQKd			admin
dbproxy_test	8XjhBQKd			proxy
select * from backends;
backend_ndx	address	hostname	state	type	weight	tag	threads_running
1	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	rw	0	NULL	0
2	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	ro	4	tag_mt	0
3	10.32.45.149:5002	dbproxy-functest02.dx.meituandianping.com	up	ro	1	tag_mt	0
add user backends slave_tag1@tag_mt|tag_mt;
status
select * from backends;
backend_ndx	address	hostname	state	type	weight	tag	threads_running
1	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	rw	0	NULL	0
2	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	ro	4	tag_mt	0
3	10.32.45.149:5002	dbproxy-functest02.dx.meituandianping.com	up	ro	1	tag_mt	0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
remove user backends slave_tag1;
status
remove user backends slave_tag2;
status
add slave tag tag_mt 2,3;
status
add user backends slave_tag1@tag_mt;
status
select * from pwds;
username	password	hosts	backends	type
slave_tag1	8XjhBQKd		tag_mt	proxy
slave_tag2	8XjhBQKd			proxy
slave_tag3	8XjhBQKd			proxy
%				proxy
dbproxy_test	8XjhBQKd			admin
dbproxy_test	8XjhBQKd			proxy
select * from backends;
backend_ndx	address	hostname	state	type	weight	tag	threads_running
1	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	rw	0	NULL	0
2	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	ro	4	tag_mt	0
3	10.32.45.149:5002	dbproxy-functest02.dx.meituandianping.com	up	ro	1	tag_mt	0
add user backends slave_tag1@tag_dp;
status
select * from backends;
backend_ndx	address	hostname	state	type	weight	tag	threads_running
1	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	rw	0	NULL	0
2	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	ro	4	tag_mt	0
3	10.32.45.149:5002	dbproxy-functest02.dx.meituandianping.com	up	ro	1	tag_mt	0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_dp*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_dp*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_dp*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_dp*/select count(*) from test.slave_tag_test;
count(*)
0
remove user backends slave_tag1;
status
remove user backends slave_tag2;
status
add slave tag tag_mt 2,3;
status
add user backends slave_tag1@tag_mt;
status
select * from pwds;
username	password	hosts	backends	type
slave_tag1	8XjhBQKd		tag_mt	proxy
slave_tag2	8XjhBQKd			proxy
slave_tag3	8XjhBQKd			proxy
%				proxy
dbproxy_test	8XjhBQKd			admin
dbproxy_test	8XjhBQKd			proxy
select * from backends;
backend_ndx	address	hostname	state	type	weight	tag	threads_running
1	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	rw	0	NULL	0
2	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	ro	4	tag_mt	0
3	10.32.45.149:5002	dbproxy-functest02.dx.meituandianping.com	up	ro	1	tag_mt	0
remove user backends slave_tag1@tag_dp;
status
select * from backends;
backend_ndx	address	hostname	state	type	weight	tag	threads_running
1	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	rw	0	NULL	0
2	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	ro	4	tag_mt	0
3	10.32.45.149:5002	dbproxy-functest02.dx.meituandianping.com	up	ro	1	tag_mt	0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
remove user backends slave_tag1;
status
remove user backends slave_tag2;
status
add slave tag tag_mt 2,3;
status
add user backends slave_tag1@tag_mt;
status
select * from pwds;
username	password	hosts	backends	type
slave_tag1	8XjhBQKd		tag_mt	proxy
slave_tag2	8XjhBQKd			proxy
slave_tag3	8XjhBQKd			proxy
%				proxy
dbproxy_test	8XjhBQKd			admin
dbproxy_test	8XjhBQKd			proxy
select * from backends;
backend_ndx	address	hostname	state	type	weight	tag	threads_running
1	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	rw	0	NULL	0
2	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	ro	4	tag_mt	0
3	10.32.45.149:5002	dbproxy-functest02.dx.meituandianping.com	up	ro	1	tag_mt	0
remove user backends slave_tag1@tag_mt;
status
select * from backends;
backend_ndx	address	hostname	state	type	weight	tag	threads_running
1	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	rw	0	NULL	0
2	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	ro	4	tag_mt	0
3	10.32.45.149:5002	dbproxy-functest02.dx.meituandianping.com	up	ro	1	tag_mt	0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
remove user backends slave_tag1;
status
remove user backends slave_tag2;
status
add slave tag tag_mt 2,3;
status
add user backends slave_tag1@tag_mt|tag_dp;
status
select * from pwds;
username	password	hosts	backends	type
slave_tag1	8XjhBQKd		tag_dp|tag_mt	proxy
slave_tag2	8XjhBQKd			proxy
slave_tag3	8XjhBQKd			proxy
%				proxy
dbproxy_test	8XjhBQKd			admin
dbproxy_test	8XjhBQKd			proxy
select * from backends;
backend_ndx	address	hostname	state	type	weight	tag	threads_running
1	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	rw	0	NULL	0
2	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	ro	4	tag_mt	0
3	10.32.45.149:5002	dbproxy-functest02.dx.meituandianping.com	up	ro	1	tag_mt	0
remove user backends slave_tag1;
status
select * from backends;
backend_ndx	address	hostname	state	type	weight	tag	threads_running
1	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	rw	0	NULL	0
2	10.32.45.150:5002	dbproxy-functest01.dx.meituandianping.com	up	ro	4	tag_mt	0
3	10.32.45.149:5002	dbproxy-functest02.dx.meituandianping.com	up	ro	1	tag_mt	0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_mt*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_dp*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_dp*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_dp*/select count(*) from test.slave_tag_test;
count(*)
0
/*slave@tag_dp*/select count(*) from test.slave_tag_test;
count(*)
0
drop table if exists slave_tag_test;
